!function(e,t){function l(e,l,i){var s={debug:!1,title:"选择标题",id:"js-mselect",relation:[0,0],render:function(e){return'<li data-id="'+e.id+'" data-value="'+e.name+'">'+e.name+"</li>"}};this.opts=t.extend({},s,i),this.level=e||1,1===this.level?this.typeBox="m-select-one":2===this.level?this.typeBox="m-select-two":3===this.level&&(this.typeBox="m-select-three"),this.debug=this.opts.debug,this.data=l,this.oneTwoRelation=this.opts.relation[0],this.twoThreeRelation=this.opts.relation[1],this.callback=this.opts.callback,this.render=this.opts.render,this.init()}l.prototype={init:function(){this.scroll=new Array,this.initSelect(),this.selectOneObj={},this.selectTwoObj={},this.selectThreeObj={},this.setOneLevel(this.opts.oneLevelId,this.opts.twoLevelId,this.opts.threeLevelId),this.lockBody()},lockBody:function(){t("body").hasClass("m-select-body")?t("body").removeClass("m-select-body"):t("body").addClass("m-select-body")},initSelect:function(){var e=this,l="";l+='<div class="m-select '+e.typeBox+'" id="'+e.opts.id+'"><div class="m-select-box"><div class="m-select-hd"><a class="m-select-btn m-select-btn-l" href="javascript:;">取消</a><a class="m-select-btn m-select-btn-r" href="javascript:;">确定</a><span class="m-select-title">请选择</span></div><div class="m-select-bd">';for(var i=0;i<e.level;i++)e.scroll[i]=e.opts.id+"-"+i,l+='<div class="m-select-area" id="'+e.scroll[i]+'">',l+="<ul></ul></div>";var s=t(l+='</div><div class="m-select-line m-select-line-t"></div><div class="m-select-line m-select-line-b"></div></div></div>');t("body").append(s),e.closeBtn=s.find(".m-select-btn-l"),e.sureBtn=s.find(".m-select-btn-r"),e.oneLevelCon=t("#"+e.scroll[0]),e.twoLevelCon=t("#"+e.scroll[1]),e.threeLevelCon=t("#"+e.scroll[2]),e.oneLevelUlCon=e.oneLevelCon.find("ul"),e.twoLevelUlCon=e.twoLevelCon.find("ul"),e.threeLevelUlCon=e.threeLevelCon.find("ul"),e.oneScroll=new IScroll("#"+e.scroll[0],{probeType:3,bounce:!1}),e.oneScroll.on("scrollStart",function(){e.clearLiStyle(e.oneLevelUlCon.find("li"))}),e.oneScroll.on("scrollEnd",function(){var t=Math.abs(this.y/35),l=1,i=0;Math.ceil(t)===Math.round(t)?(i=35*Math.ceil(t),l=Math.ceil(t)+1):(i=35*Math.floor(t),l=Math.floor(t)+1),e.oneScroll.scrollTo(0,-i,0);var s=e.setLiStyle(e.oneLevelUlCon.find("li"),l);e.selectOneObj=e.attrToData(s,l),e.level>1&&1===e.oneTwoRelation&&e.setTwoLevel(e.selectOneObj.id,e.selectTwoObj.id,e.selectThreeObj.id)}),e.level>=2&&(e.twoScroll=new IScroll("#"+e.scroll[1],{probeType:3,bounce:!1}),e.twoScroll.on("scrollStart",function(){e.clearLiStyle(e.twoLevelUlCon.find("li"))}),e.twoScroll.on("scrollEnd",function(){var t=Math.abs(this.y/35),l=1,i=0;Math.ceil(t)===Math.round(t)?(i=35*Math.ceil(t),l=Math.ceil(t)+1):(i=35*Math.floor(t),l=Math.floor(t)+1),e.twoScroll.scrollTo(0,-i,0);var s=e.setLiStyle(e.twoLevelUlCon.find("li"),l);e.selectTwoObj=e.attrToData(s,l),e.level>2&&1===e.twoThreeRelation&&e.setThreeLevel(e.selectOneObj.id,e.selectTwoObj.id,e.selectThreeObj.id)})),e.level>=3&&(e.threeScroll=new IScroll("#"+e.scroll[2],{probeType:3,bounce:!1}),e.threeScroll.on("scrollStart",function(){e.clearLiStyle(e.threeLevelUlCon.find("li"))}),e.threeScroll.on("scrollEnd",function(){var t=Math.abs(this.y/35),l=1,i=0;Math.ceil(t)===Math.round(t)?(i=35*Math.ceil(t),l=Math.ceil(t)+1):(i=35*Math.floor(t),l=Math.floor(t)+1),e.threeScroll.scrollTo(0,-i,0);var s=e.setLiStyle(e.threeLevelUlCon.find("li"),l);e.selectThreeObj=e.attrToData(s,l)})),e.closeBtn.on("click",function(){t("#"+e.opts.id).remove(),e.lockBody()}),e.sureBtn.on("click",function(){t("#"+e.opts.id).remove(),e.lockBody(),e.callback(e.selectOneObj,e.selectTwoObj,e.selectThreeObj)})},attrToData:function(e,t){var l={};for(var i in e[0].dataset)l[i]=e[0].dataset[i];return l.dom=e,l.atindex=t,l},clearLiStyle:function(e){e.each(function(e,l){t(this).hasClass("at")&&t(this).removeClass("at"),t(this).hasClass("side1")&&t(this).removeClass("side1"),t(this).hasClass("side2")&&t(this).removeClass("side2")})},setLiStyle:function(e,t){return e.eq(t+2).addClass("at"),e.eq(t+3).addClass("side1"),e.eq(t+4).addClass("side2"),e.eq(t+1).addClass("side1"),e.eq(t).addClass("side2"),e.eq(t+2)},setOneLevel:function(e,l,i){if(t.isArray(this.data[0]))this.renderOneLevel(e,l,i,this.data[0]);else{if(!t.isFunction(this.data[0]))throw new Error("data format error");this.data[0](function(t){this.renderOneLevel(e,l,i,t)}.bind(this))}},renderOneLevel:function(e,t,l,i){var s=this;this.debug&&console.log(i),i.some(function(t,l,i){return t.id==e})||(e=i[0].id);var o=0,n="";n+=this.getWhiteItem(),i.forEach(function(t,l){t.id==e&&(o=l+1),n+=s.render(t)}),n+=this.getWhiteItem(),this.oneLevelUlCon.html(n),this.oneScroll.refresh(),this.oneScroll.scrollToElement(":nth-child("+o+")",0),this.level>=2&&this.setTwoLevel(e,t,l);var r=this.setLiStyle(this.oneLevelUlCon.find("li"),o);this.selectOneObj=this.attrToData(r,o)},setTwoLevel:function(e,l,i){if(t.isArray(this.data[1]))this.renderTwoLevel(e,l,i,this.data[1]);else{if(!t.isFunction(this.data[1]))throw new Error("data format error");this.data[1](e,function(t){this.renderTwoLevel(e,l,i,t)}.bind(this))}},renderTwoLevel:function(e,t,l,i){var s=this;this.debug&&console.log(i),i.some(function(e,l,i){return e.id==t})||(t=i[0].id);var o=0,n="";n+=this.getWhiteItem(),i.forEach(function(e,l){e.id==t&&(o=l+1),n+=s.render(e)}),n+=this.getWhiteItem(),this.twoLevelUlCon.html(n),this.twoScroll.refresh(),this.twoScroll.scrollToElement(":nth-child("+o+")",0),this.level>=3&&this.setThreeLevel(e,t,l);var r=this.setLiStyle(this.twoLevelUlCon.find("li"),o);this.selectTwoObj=this.attrToData(r,o)},setThreeLevel:function(e,l,i){if(t.isArray(this.data[2]))this.renderThreeLevel(e,l,i,this.data[2]);else{if(!t.isFunction(this.data[2]))throw new Error("data format error");this.data[2](e,l,function(t){this.renderThreeLevel(e,l,i,t)}.bind(this))}},renderThreeLevel:function(e,t,l,i){var s=this;this.debug&&console.log(i),i.some(function(e,t,i){return e.id==l})||(l=i[0].id);var o=0,n="";n+=this.getWhiteItem(),i.forEach(function(e,t){e.id==l&&(o=t+1),n+=s.render(e)}),n+=this.getWhiteItem(),this.threeLevelUlCon.html(n),this.threeScroll.refresh(),this.threeScroll.scrollToElement(":nth-child("+o+")",0);var r=this.setLiStyle(this.threeLevelUlCon.find("li"),o);this.selectThreeObj=this.attrToData(r,o)},getWhiteItem:function(){return"<li></li><li></li><li></li>"}},"undefined"!=typeof module&&module.exports?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):window.MSelect=l}(window,jQuery);