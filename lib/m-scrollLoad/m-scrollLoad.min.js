!function(t){function i(i,o){this.$element=t(i),this.options=t.extend(!0,{},s,o),this.ajaxLoading=!1,this.colHeightArray=[],this.colLeftArray=[],this._init()}var o=t(window),s={itemClass:"waterfall-item",spaceX:10,spaceY:10,colNum:2,resizeable:!1,isFadeIn:!0,ajaxCallback:null};i.prototype={constructor:i,_init:function(){var t=this;o.on("load",function(){t._positionAll()}),this.options.resizeable&&o.on("resize",function(){t._positionAll()}),this._doScroll()},_getColumnCount:function(){var i=this.$element.width(),o=t(this.options.itemClass).eq(0).outerWidth(),s=Math.floor(i/(o+this.options.spacingWidth)),n=0,e=0;i>(n=(s=s>this.options.minColCount?s:this.options.minColCount)*o)&&(e=Math.floor((i-n-s*this.options.spacingWidth)/2)),this.itemWidth=o,this.cols=s,this.leftOffset="center"==this.options.itemAlign?e:0},_positionAll:function(){var i,o=this,s=t(this.options.itemClass);minIndex,this.colWidth=(this.$element.width()-(this.options.colNum+1)*this.options.spaceX)/this.options.colNum;for(var n=0;n<opts.colNum;n++)this.colLeftArray[n]=n*(this.colWidth+this.options.spaceX)+this.options.spaceX,opts.colHeightArray[n]=0;s.each(function(n){t(this).css("position","absolute"),n<o.cols?(t(this).css("top",0),t(this).css("left",o.leftOffset+n*o.itemWidth+n*o.options.spacingWidth),o.colHeightArray.push(t(this).outerHeight())):(i=Math.min.apply(null,o.colHeightArray),minIndex=t.inArray(i,o.colHeightArray),t(this).css("top",i+o.options.spacingHeight),t(this).css("left",s.eq(minIndex).offset().left),o.colHeightArray[minIndex]+=t(this).outerHeight()+o.options.spacingHeight),o.options.isFadeIn&&t(this).animate({opacity:1},300)}),this.$element.css("height",Math.max.apply(null,o.colHeightArray))},_doScroll:function(){var i,s=this;o.on("scroll",function(){i&&clearTimeout(i),i=setTimeout(function(){var i=t(s.options.itemClass).last(),n=o.scrollTop()+o.height();!s.ajaxLoading&&n>i.offset().top+i.outerHeight()/2&&(s.ajaxLoading=!0,s.options.ajaxCallback&&s.options.ajaxCallback(function(){s._positionAll()},function(){s.ajaxLoading=!1}))},100)})}},t.fn.waterfall=function(o){return this.each(function(){t.data(this,"plugin_waterfall")||t.data(this,"plugin_waterfall",new i(this,o))}),this}}(jQuery);