!function(e){var t;e.fn.MFall=function(a){if("string"==typeof a)return e.fn.MFall.methods[a](this);var l={url:"",model:"",page:!1,pageSize:10,pageIndex:1,total:0,isOver:!1,isOneShow:!0,initNoData:"",noData:"",queryParams:function(){return{}},onLoadSuccess:function(e){},onBeforeLoad:function(){},itemClass:"fall-box",imgClass:"fall-img",gutter:10,colNum:2,colWidth:0,colLeft:[],colHeight:[],onSuccessFall:function(){}};t=e.extend(l,a);var n=e(this);return e(window).scroll(function(){var a=Math.ceil(e(window).height())+Math.ceil(e(window).scrollTop());e(document).height()<=a&&0==t.isOver&&n.MFall("load")}),n.MFall("init"),n},e.fn.MFall.methods={init:function(e){t.colWidth=(e.width()-(t.colNum-1)*t.gutter)/t.colNum;for(var a=0;a<t.colNum;a++)t.colLeft[a]=a*(t.colWidth+t.gutter),t.colHeight[a]=0;e.MFall("load")},load:function(a){var l=t.queryParams();t.page?(l.pageIndex=t.pageIndex,l.pageSize=t.pageSize):(l.offset=(t.pageIndex-1)*t.pageSize,l.limit=t.pageSize),t.onBeforeLoad(),e.ajax({url:t.url,type:"get",dataType:"json",data:l}).done(function(e){if(console.log(e),e.total&&(t.total=e.total),2==t.pageIndex&&(t.isOneShow=!1),t.page)if(t.total>=t.pageIndex*t.pageSize){t.pageIndex++;l=template(t.model,e);a.append(l),a.MFall("fall"),t.onLoadSuccess(e)}else t.isOver=!0,t.isOneShow?a.append(t.initNoData):a.append(t.noData);else if(e.data&&e.data.length){t.pageIndex++;var l=template(t.model,e);a.append(l),a.MFall("fall"),t.onLoadSuccess(e)}else t.isOver=!0,t.isOneShow?a.append(t.initNoData):a.append(t.noData)}).fail(function(){console.log("error")})},fall:function(a){function l(){a.height(Math.max.apply(null,t.colHeight)+2*t.gutter)}function n(){for(var e=Math.min.apply(null,t.colHeight),a=0,l=0;l<t.colHeight.length;l++)if(t.colHeight[l]==e){a=l;break}return{min:e,index:a}}var o=a.find("."+t.itemClass),i=o.find("."+t.imgClass),s=i.length;o.css("width",t.colWidth+"px"),i.load(function(){s--,console.log(s),s<=0&&(o.each(function(){var a=n(),l=t.colLeft[a.index],o=a.min+t.gutter,i=e(this).height()+t.gutter;e(this).css({left:l+"px",top:o+"px"}),t.colHeight[a.index]+=i}),a.find("."+t.itemClass).removeClass(t.itemClass),l(),t.onSuccessFall())})},reLoad:function(e){t.pageIndex=1,t.isOver=!1,t.isOneShow=!0,e.html(""),e.MFall("init")}}}(jQuery);