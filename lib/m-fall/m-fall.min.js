!function(e){var t;e.fn.MFall=function(a){if("string"==typeof a)return e.fn.MFall.methods[a](this);var n={url:"",model:"",page:!1,pageSize:10,pageIndex:1,total:0,isOver:!1,isOneShow:!0,initNoData:"",noData:"",queryParams:function(){return{}},onLoadSuccess:function(e){},onBeforeLoad:function(){},itemClass:"fall-box",imgClass:"fall-img",gutter:10,colNum:2,colWidth:0,colLeft:[],colHeight:[],onSuccessFall:function(){}};t=e.extend(n,a);var i=e(this);return e(window).scroll(function(){var a=Math.ceil(e(window).height())+Math.ceil(e(window).scrollTop());e(document).height()<=a&&0==t.isOver&&i.MFall("load")}),i.MFall("init"),i},e.fn.MFall.methods={init:function(e){t.colWidth=(e.width()-(t.colNum-1)*t.gutter)/t.colNum;for(var a=0;a<t.colNum;a++)t.colLeft[a]=a*(t.colWidth+t.gutter),t.colHeight[a]=0;e.MFall("load")},load:function(a){var n=t.queryParams();t.page?(n.pageIndex=t.pageIndex,n.pageSize=t.pageSize):(n.offset=(t.pageIndex-1)*t.pageSize,n.limit=t.pageSize),e.mAjax(t.url,n,function(e){if(e.total&&(t.total=e.total),2==t.pageIndex&&(t.isOneShow=!1),t.page)if(t.total>=t.pageIndex*t.pageSize){t.pageIndex++,t.onBeforeLoad();n=template(t.model,e);a.append(n),a.MFall("fall"),t.onLoadSuccess(e)}else t.isOver=!0,t.isOneShow?a.append(t.initNoData):a.append(t.noData);else if(e.data&&e.data.length){t.pageIndex++,t.onBeforeLoad();var n=template(t.model,e);a.append(n),a.MFall("fall"),t.onLoadSuccess(e)}else t.isOver=!0,t.isOneShow?a.append(t.initNoData):a.append(t.noData)})},fall:function(a){function n(){a.height(Math.max.apply(null,t.colHeight)+2*t.gutter)}function i(){for(var e=Math.min.apply(null,t.colHeight),a=0,n=0;n<t.colHeight.length;n++)if(t.colHeight[n]==e){a=n;break}return{min:e,index:a}}var l=a.find("."+t.itemClass),o=l.find("."+t.imgClass),s=o.length;l.css("width",t.colWidth+"px"),o.load(function(){--s<=0&&(l.each(function(){var a=i(),n=t.colLeft[a.index],l=a.min+t.gutter,o=e(this).height()+t.gutter;e(this).css({left:n+"px",top:l+"px"}),t.colHeight[a.index]+=o}),a.find("."+t.itemClass).removeClass(t.itemClass),n(),t.onSuccessFall())})},reLoad:function(e){t.pageIndex=1,t.isOver=!1,t.isOneShow=!0,e.html(""),e.MFall("init")}}}(jQuery);