!function(t){function o(o,i){this.$element=t(o),this.opts=t.extend(!0,{},e,i),this.colHeightArray=[],this.colLeftArray=[],this._init()}t(window);var e={debug:!1,itemClass:"waterfall-item",spaceX:10,spaceY:10,colNum:2,resizeable:!1,isFadeIn:!0,onFallAfter:function(){}};o.prototype={constructor:o,_init:function(){var t=this;t.colWidth=(t.$element.width()-(t.opts.colNum+1)*t.opts.spaceX)/t.opts.colNum;for(var o=0;o<this.opts.colNum;o++)t.colHeightArray[o]=0,t.colLeftArray[o]=o*(t.colWidth+t.opts.spaceX)+t.opts.spaceX;this.items=[],this.index=0,t._positionAll()},_positionAll:function(){var o,e,i=this,l=i.$element.find("."+i.opts.itemClass);l.width(i.colWidth),i.opts.debug&&console.log("瀑布流开始布局"),l.each(function(l){i._attrToData(t(this),i.colHeightArray),o=Math.min.apply(null,i.colHeightArray),e=t.inArray(o,i.colHeightArray),i.opts.debug&&console.log(i.colHeightArray),t(this).css({position:"absolute",top:i.colHeightArray[e],left:i.colLeftArray[e]}),i.colHeightArray[e]+=t(this).outerHeight()+i.opts.spaceY}),i.opts.debug&&console.log("onFallAfter: 瀑布流布局结束"),i.opts.onFallAfter(),l.removeClass(i.opts.itemClass),i.$element.css("height",Math.max.apply(null,i.colHeightArray))},_attrToData:function(t,o){var e=this,i={},l=[];i.dom=t;for(var r=0;r<o.length;r++)l[r]=o[r];i.colHeight=l,e.items[e.index]=i,e.index++},fall:function(){this._positionAll()},reFresh:function(){this._init()},remove:function(t){var o=this;o.opts.debug&&console.log("删除第--"+t+"--个元素"),o.items[t].dom.remove(),o._reFall(t)},_reFall:function(o){var e=this;e.opts.debug&&(console.log("重新布局,从第--"+o+"--个元素开始"),console.log(e.items)),e.index=0;var i,l,r,s=e.items,a=e.items[o];e.items=[],e.colHeightArray=a.colHeight;for(var n=0,c=s.length-1;n<c;n++)n<o?e._attrToData(s[n].dom,s[n].colHeight):(r=s[n+1].dom,e._attrToData(r,e.colHeightArray),i=Math.min.apply(null,e.colHeightArray),l=t.inArray(i,e.colHeightArray),e.opts.debug&&console.log(e.colHeightArray),r.css({top:e.colHeightArray[l],left:e.colLeftArray[l]}),e.colHeightArray[l]+=r.outerHeight()+e.opts.spaceY);e.opts.debug&&(console.log("布局结束"),console.log(e.items)),e.$element.css("height",Math.max.apply(null,e.colHeightArray))}},"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd?define(function(){return o}):window.WaterFall=o,t.fn.WaterFall=function(t){return new o(this,t)}}(jQuery);