<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<title>时间选择器</title>
	<script src="js/lib/jquery/1.9.1/jquery.js"></script>
	<script src="js/lib/iscroll/iscroll.js"></script>
	<link rel="stylesheet" href="js/lib/m-select/1.0/m-select.css">
	<script src="js/lib/m-select/1.0/m-select.js"></script>
	<style>
		.box {
			height: 300px;
			background-color: #f00;
			margin-bottom: 20px;
		}
	</style>
</head>
<body>
	<span onclick="select()" data-aid="1" data-bid="2" data-cid="3">启动</span>

	<div class="box"></div>
	<div class="box"></div>
	<div class="box"></div>
	<div class="box"></div>
	<div class="box"></div>
	<div class="box"></div>
	<div class="box"></div>
	<div class="box"></div>

	<script>

		// 初始化时间
	    var now = new Date();
	    var nowYear = now.getFullYear();

	    // 数据初始化
	    function formatYear (nowYear) {
	        var arr = [];
	        for (var i = nowYear - 5; i <= nowYear + 5; i++) {
	            arr.push({
	                id: i + '',
	                name: i + '年'
	            });
	        }
	        return arr;
	    }
	    function formatMonth () {
	        var arr = [];
	        for (var i = 1; i <= 12; i++) {
	            arr.push({
	                id: i + '',
	                name: i + '月'
	            });
	        }
	        return arr;
	    }
	    function formatDate (count) {
	        var arr = [];
	        for (var i = 1; i <= count; i++) {
	            arr.push({
	                id: i + '',
	                name: i + '日'
	            });
	        }
	        return arr;
	    }
	    var yearData = function(callback) {
	        callback(formatYear(nowYear))
	    }
	    var monthData = function (year, callback) {
	        callback(formatMonth());
	    };
	    var dateData = function (year, month, callback) {
	        if (/^(1|3|5|7|8|10|12)$/.test(month)) {
	            callback(formatDate(31));
	        }
	        else if (/^(4|6|9|11)$/.test(month)) {
	            callback(formatDate(30));
	        }
	        else if (/^2$/.test(month)) {
	            if (year % 4 === 0 && year % 100 !==0 || year % 400 === 0) {
	                callback(formatDate(29));
	            }
	            else {
	                callback(formatDate(28));
	            }
	        }
	        else {
	            throw new Error('month is illegal');
	        }
	    };

		var d = [yearData,monthData,dateData];

		function select() {
			var s = new MSelect(3,d,{
				relation: [0,1],
				callback: function(a,b,c) {
					$('span').html(a.value+','+b.value+','+c.value);
				}
			});
		}

	</script>
</body>
</html>